<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1014.5833px" preserveAspectRatio="none" style="width:1393px;height:1014px;background:#FFFFFF;" version="1.1" viewBox="0 0 1393 1014" width="1393.75px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vw2zo60pskje" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="767.9036" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="261.9792" y="140.1693"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="585.9375" y="390.2344"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="420.5485" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="725" y="299.1943"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="936.4583" y="773.1445"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1128.125" y="464.4694"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1317.7083" y="847.3796"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="512.6302" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1035.4167" x="175" y="215.446"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="57.2917" x2="57.2917" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="266.6667" x2="266.6667" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="591.1458" x2="591.1458" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="729.6875" x2="729.6875" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="941.1458" x2="941.1458" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1133.3333" x2="1133.3333" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1322.9167" x2="1322.9167" y1="91.9759" y2="926.8229"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="5.2083" y="88.5366">Admin_Owner</text><ellipse cx="57.8125" cy="15.625" fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M57.8125,23.9583 L57.8125,52.0833 M44.2708,32.2917 L71.3542,32.2917 M57.8125,52.0833 L44.2708,67.7083 M57.8125,52.0833 L71.3542,67.7083 " fill="none" filter="url(#f1vw2zo60pskje)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="5.2083" y="939.3178">Admin_Owner</text><ellipse cx="57.8125" cy="953.1738" fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M57.8125,961.5072 L57.8125,989.6322 M44.2708,969.8405 L71.3542,969.8405 M57.8125,989.6322 L44.2708,1005.2572 M57.8125,989.6322 L71.3542,1005.2572 " fill="none" filter="url(#f1vw2zo60pskje)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="185.4167" y="21.2565"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="204.1667" y="42.0848">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="248.4375" y="59.0607">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="192.7083" y="76.0366">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="185.4167" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="204.1667" y="946.6095">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="248.4375" y="963.5854">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="192.7083" y="980.5613">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="517.1875" y="38.2324"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="524.4792" y="59.0607">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="561.4583" y="76.0366">des IDP</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="517.1875" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="524.4792" y="946.6095">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="561.4583" y="963.5854">des IDP</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="675.5208" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="682.8125" y="76.0366">Auth-Service</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="675.5208" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="682.8125" y="946.6095">Auth-Service</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="894.2708" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="901.5625" y="76.0366">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="894.2708" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="901.5625" y="946.6095">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1066.6667" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1073.9583" y="76.0366">Identity Provider</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1066.6667" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1073.9583" y="946.6095">Identity Provider</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1262.5" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1269.7917" y="76.0366">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#f1vw2zo60pskje)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1262.5" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1269.7917" y="946.6095">FHIR-Directory</text><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="767.9036" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="261.9792" y="140.1693"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="585.9375" y="390.2344"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="420.5485" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="725" y="299.1943"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="936.4583" y="773.1445"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1128.125" y="464.4694"/><rect fill="#FFFFFF" filter="url(#f1vw2zo60pskje)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1317.7083" y="847.3796"/><polygon fill="#383838" points="249.4792,136.0026,259.8958,140.1693,249.4792,144.3359,253.6458,140.1693" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="57.8125" x2="255.7292" y1="140.1693" y2="140.1693"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="65.1042" y="119.1289">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="65.1042" y="134.8923">ändern</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="316.1458" y1="186.2793" y2="186.2793"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="316.1458" x2="316.1458" y1="186.2793" y2="199.821"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="273.4375" x2="316.1458" y1="199.821" y2="199.821"/><polygon fill="#383838" points="283.8542,195.6543,273.4375,199.821,283.8542,203.9876,279.6875,199.821" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="279.6875" y="165.239">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="279.6875" y="181.0023">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M175,215.446 L241.6667,215.446 L241.6667,222.7376 L231.25,233.1543 L175,233.1543 L175,215.446 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="512.6302" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1035.4167" x="175" y="215.446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="190.625" y="229.0573">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="257.2917" y="228.1652">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="316.1458" y1="255.306" y2="255.306"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="316.1458" x2="316.1458" y1="255.306" y2="268.8477"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="273.4375" x2="316.1458" y1="268.8477" y2="268.8477"/><polygon fill="#383838" points="283.8542,264.681,273.4375,268.8477,283.8542,273.0143,279.6875,268.8477" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="279.6875" y="250.029">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#383838" points="712.5,295.0277,722.9167,299.1943,712.5,303.361,716.6667,299.1943" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="718.75" y1="299.1943" y2="299.1943"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="279.6875" y="293.9173">GET /owner-authenticate</text><polygon fill="#383838" points="283.8542,325.3743,273.4375,329.541,283.8542,333.7077,279.6875,329.541" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="277.6042" x2="723.9583" y1="329.541" y2="329.541"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="290.1042" y="324.264">Redirect to IDP Authorization Endpoint</text><polygon fill="#383838" points="1120.8333,355.721,1131.25,359.8877,1120.8333,364.0544,1125,359.8877" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="1127.0833" y1="359.8877" y2="359.8877"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="279.6875" y="354.6107">GET /authorize</text><polygon fill="#383838" points="283.8542,386.0677,273.4375,390.2344,283.8542,394.401,279.6875,390.2344" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="277.6042" x2="1132.2917" y1="390.2344" y2="390.2344"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="290.1042" y="384.9574">Authentication challenge</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="596.3542" x2="640.1042" y1="420.5811" y2="420.5811"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="640.1042" x2="640.1042" y1="420.5811" y2="434.1227"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="597.3958" x2="640.1042" y1="434.1227" y2="434.1227"/><polygon fill="#383838" points="607.8125,429.9561,597.3958,434.1227,607.8125,438.2894,603.6458,434.1227" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="603.6458" y="415.3041">Authentication</text><polygon fill="#383838" points="1115.625,460.3027,1126.0417,464.4694,1115.625,468.6361,1119.7917,464.4694" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="591.1458" x2="1121.875" y1="464.4694" y2="464.4694"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="598.4375" y="459.1924">Authentication challenge response</text><polygon fill="#383838" points="283.8542,490.6494,273.4375,494.8161,283.8542,498.9827,279.6875,494.8161" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="277.6042" x2="1127.0833" y1="494.8161" y2="494.8161"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="290.1042" y="489.5391">Authorization Response with Authorization code</text><polygon fill="#383838" points="712.5,520.9961,722.9167,525.1628,712.5,529.3294,716.6667,525.1628" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="718.75" y1="525.1628" y2="525.1628"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="322.9167" x="279.6875" y="519.8858">GET /owner-authenticate with Authorization code</text><polygon fill="#383838" points="1115.625,551.3428,1126.0417,555.5094,1115.625,559.6761,1119.7917,555.5094" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="735.4167" x2="1121.875" y1="555.5094" y2="555.5094"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="742.7083" y="550.2324">POST /tokenEndpoint {authorization code}</text><polygon fill="#383838" points="746.875,581.6895,736.4583,585.8561,746.875,590.0228,742.7083,585.8561" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="740.625" x2="1132.2917" y1="585.8561" y2="585.8561"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="753.125" y="580.5791">Response {id_token}</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="735.4167" x2="779.1667" y1="616.2028" y2="616.2028"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="779.1667" x2="779.1667" y1="616.2028" y2="629.7445"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="736.4583" x2="779.1667" y1="629.7445" y2="629.7445"/><polygon fill="#383838" points="746.875,625.5778,736.4583,629.7445,746.875,633.9111,742.7083,629.7445" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="87.5" x="742.7083" y="610.9258">Prüfe idtoken</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="735.4167" x2="779.1667" y1="660.0911" y2="660.0911"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="779.1667" x2="779.1667" y1="660.0911" y2="673.6328"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="736.4583" x2="779.1667" y1="673.6328" y2="673.6328"/><polygon fill="#383838" points="746.875,669.4661,736.4583,673.6328,746.875,677.7995,742.7083,673.6328" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="742.7083" y="654.8141">erzeuge owner-accesstoken</text><polygon fill="#383838" points="283.8542,715.5762,273.4375,719.7428,283.8542,723.9095,279.6875,719.7428" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="277.6042" x2="729.1667" y1="719.7428" y2="719.7428"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="170.8333" x="290.1042" y="698.7025">HTTP 200 OK, Result body</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="267.7083" x="290.1042" y="714.4658">{"access_token"="owner-accesstoken"}</text><polygon fill="#383838" points="923.9583,768.9779,934.375,773.1445,923.9583,777.3112,928.125,773.1445" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="272.3958" x2="930.2083" y1="773.1445" y2="773.1445"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="394.7917" x="279.6875" y="752.1042">GET /owner/TIHealthcareService?providedBy.id=telematikID</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="269.7917" x="279.6875" y="767.8675">Authorization Bearer owner-accesstoken</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="946.875" x2="990.625" y1="803.4912" y2="803.4912"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="990.625" x2="990.625" y1="803.4912" y2="817.0329"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="947.9167" x2="990.625" y1="817.0329" y2="817.0329"/><polygon fill="#383838" points="958.3333,812.8662,947.9167,817.0329,958.3333,821.1995,954.1667,817.0329" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="954.1667" y="798.2142">prüfe owner-accesstoken</text><polygon fill="#383838" points="1305.2083,843.2129,1315.625,847.3796,1305.2083,851.5462,1309.375,847.3796" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="946.875" x2="1311.4583" y1="847.3796" y2="847.3796"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="351.0417" x="954.1667" y="842.1026">GET /TIHealthcareService?providedBy.id=telematikID</text><polygon fill="#383838" points="958.3333,873.5596,947.9167,877.7262,958.3333,881.8929,954.1667,877.7262" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="952.0833" x2="1316.6667" y1="877.7262" y2="877.7262"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="964.5833" y="872.4492">HTTP 200 OK (Result Body json)</text><polygon fill="#383838" points="278.6458,903.9063,268.2292,908.0729,278.6458,912.2396,274.4792,908.0729" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="272.3958" x2="940.625" y1="908.0729" y2="908.0729"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="284.8958" y="902.7959">HTTP 200 OK (Result Body json)</text><!--MD5=[8801f07aea4f60a788293f2ec77c287c]
@startuml sd_FHIR-Directory, owner
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen TIOrganization- oder TIPractitioner-Einträgen'
actor oa as "Admin_Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
oa -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
cl -> cl: Erzeuge PKCE Code für verifier und challenge
cl -> au: GET /owner-authenticate
activate au
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

'cl -> idp: GET /authorize + scope=VZD-FHIR-Directory + openid + code_challenge
'activate idp
'idp - -> cl: HTTP 200 OK (Result Body "Bestätige Identität in der Authenticator App des IDP")
'oa -> aa: Authentisierung und\nEinverständnis
'activate aa
'aa -> idp: Authentisierung und Einverständnis
'deactivate aa
'idp - -> cl: HTTP 200 OK (Result Body {"AuthorizationCode"})

'cl -> idp: POST /token\ngrant_type=authorization_code\ncode="AuthorizationCode"\ncode_verifier="verifier"
'idp -> idp: Auswertung des PKCE codes
'idp - -> cl: HTTP 200 OK (Result Body {\n"id_token": "idtoken"\n"access_token": "accesstoken"\n"refresh_token": "refreshtoken"...})
deactivate idp
'cl -> fp: GET /owner-authenticate... (Auth Header mit\naccesstoken und idtoken)
au -> au: Prüfe idtoken
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: GET /owner/TIHealthcareService?providedBy.id=telematikID\nAuthorization Bearer owner-accesstoken
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: GET /TIHealthcareService?providedBy.id=telematikID
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml sd_FHIR-Directory, owner
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor oa as "Admin_Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
oa -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
cl -> cl: Erzeuge PKCE Code für verifier und challenge
cl -> au: GET /owner-authenticate
activate au
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}


deactivate idp
au -> au: Prüfe idtoken
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: GET /owner/TIHealthcareService?providedBy.id=telematikID\nAuthorization Bearer owner-accesstoken
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: GET /TIHealthcareService?providedBy.id=telematikID
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>