<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1368.75px" preserveAspectRatio="none" style="width:1776px;height:1368px;background:#FFFFFF;" version="1.1" viewBox="0 0 1776 1368" width="1776.0417px" zoomAndPan="magnify"><defs><filter height="300%" id="f1hmhzdlblxb36" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="1122.2087" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="235.9375" y="140.1693"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="549.4792" y="697.6644"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="748.6735" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="754.6875" y="341.1377"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1092.1875" y="1127.4495"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1283.8542" y="771.8994"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1496.3542" y="1201.6846"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1651.5625" y="280.4443"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1651.5625" y="465.446"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="882.6986" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1623.4375" x="138.5417" y="215.446"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="154.6549" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1602.6042" x="148.9583" y="240.5843"/><rect fill="#FFFFFF" height="45.7682" style="stroke:none;stroke-width:1.0416666666666667;" width="1602.6042" x="148.9583" y="349.471"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="153.9551" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1056.7708" x="694.7917" y="409.8226"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="107.7067" style="stroke:#000000;stroke-width:2.0833333333333335;" width="402.6042" x="694.7917" y="908.9111"/><rect fill="#FFFFFF" height="45.9717" style="stroke:none;stroke-width:1.0416666666666667;" width="402.6042" x="694.7917" y="970.6462"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="31.25" x2="31.25" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="240.625" x2="240.625" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="554.6875" x2="554.6875" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="759.375" x2="759.375" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1096.875" x2="1096.875" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1289.0625" x2="1289.0625" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1501.5625" x2="1501.5625" y1="91.9759" y2="1281.1279"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1656.7708" x2="1656.7708" y1="91.9759" y2="1281.1279"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="46.875" x="5.2083" y="88.5366">Owner</text><ellipse cx="31.7708" cy="15.625" fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M31.7708,23.9583 L31.7708,52.0833 M18.2292,32.2917 L45.3125,32.2917 M31.7708,52.0833 L18.2292,67.7083 M31.7708,52.0833 L45.3125,67.7083 " fill="none" filter="url(#f1hmhzdlblxb36)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="46.875" x="5.2083" y="1293.6228">Owner</text><ellipse cx="31.7708" cy="1307.4788" fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M31.7708,1315.8122 L31.7708,1343.9372 M18.2292,1324.1455 L45.3125,1324.1455 M31.7708,1343.9372 L18.2292,1359.5622 M31.7708,1343.9372 L45.3125,1359.5622 " fill="none" filter="url(#f1hmhzdlblxb36)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="159.375" y="21.2565"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="178.125" y="42.0848">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="222.3958" y="59.0607">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="166.6667" y="76.0366">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="159.375" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="178.125" y="1300.9145">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="222.3958" y="1317.8904">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="166.6667" y="1334.8663">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="480.7292" y="38.2324"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="488.0208" y="59.0607">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="525" y="76.0366">des IDP</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="480.7292" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="488.0208" y="1300.9145">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="525" y="1317.8904">des IDP</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="705.2083" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="712.5" y="76.0366">Auth-Service</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="705.2083" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="712.5" y="1300.9145">Auth-Service</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="1050" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1057.2917" y="76.0366">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="1050" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1057.2917" y="1300.9145">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1222.3958" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1229.6875" y="76.0366">Identity Provider</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1222.3958" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1229.6875" y="1300.9145">Identity Provider</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1441.1458" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1448.4375" y="76.0366">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1441.1458" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1448.4375" y="1300.9145">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="164.5833" x="1572.3958" y="38.2324"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1605.2083" y="59.0607">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1579.6875" y="76.0366">Registrierungsdienst</text><rect fill="#F8F8F8" filter="url(#f1hmhzdlblxb36)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="164.5833" x="1572.3958" y="1280.0863"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1605.2083" y="1300.9145">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1579.6875" y="1317.8904">Registrierungsdienst</text><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="1122.2087" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="235.9375" y="140.1693"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="549.4792" y="697.6644"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="748.6735" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="754.6875" y="341.1377"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1092.1875" y="1127.4495"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1283.8542" y="771.8994"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1496.3542" y="1201.6846"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1651.5625" y="280.4443"/><rect fill="#FFFFFF" filter="url(#f1hmhzdlblxb36)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1651.5625" y="465.446"/><polygon fill="#383838" points="223.4375,136.0026,233.8542,140.1693,223.4375,144.3359,227.6042,140.1693" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="31.7708" x2="229.6875" y1="140.1693" y2="140.1693"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="39.0625" y="119.1289">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="39.0625" y="134.8923">ändern</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="290.1042" y1="186.2793" y2="186.2793"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="290.1042" x2="290.1042" y1="186.2793" y2="199.821"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="247.3958" x2="290.1042" y1="199.821" y2="199.821"/><polygon fill="#383838" points="257.8125,195.6543,247.3958,199.821,257.8125,203.9876,253.6458,199.821" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="253.6458" y="165.239">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="253.6458" y="181.0023">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M138.5417,215.446 L205.2083,215.446 L205.2083,222.7376 L194.7917,233.1543 L138.5417,233.1543 L138.5417,215.446 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="882.6986" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1623.4375" x="138.5417" y="215.446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="154.1667" y="229.0573">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="220.8333" y="228.1652">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M148.9583,240.5843 L215.625,240.5843 L215.625,247.876 L205.2083,258.2926 L148.9583,258.2926 L148.9583,240.5843 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="154.6549" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1602.6042" x="148.9583" y="240.5843"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="164.5833" y="254.1957">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="125" x="231.25" y="253.3035">[Org-Admin-Client]</text><polygon fill="#383838" points="1639.0625,276.2777,1649.4792,280.4443,1639.0625,284.611,1643.2292,280.4443" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="1645.3125" y1="280.4443" y2="280.4443"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="253.6458" y="275.1673">POST /regservice/user/{userId}/request_token</text><polygon fill="#383838" points="257.8125,306.6243,247.3958,310.791,257.8125,314.9577,253.6458,310.791" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1655.7292" y1="310.791" y2="310.791"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="948.9583" x="264.0625" y="305.514">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"}</text><polygon fill="#383838" points="742.1875,336.971,752.6042,341.1377,742.1875,345.3044,746.3542,341.1377" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="341.1377" y2="341.1377"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="253.6458" y="335.8607">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="148.9583" x2="1751.5625" y1="350.5127" y2="350.5127"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="145.8333" x="154.1667" y="361.1486">[TI-Messenger-Client]</text><polygon fill="#383838" points="742.1875,382.7393,752.6042,386.9059,742.1875,391.0726,746.3542,386.9059" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="386.9059" y2="386.9059"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="253.6458" y="381.6289">GET /owner-authenticate</text><path d="M694.7917,409.8226 L761.4583,409.8226 L761.4583,417.1143 L751.0417,427.5309 L694.7917,427.5309 L694.7917,409.8226 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="153.9551" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1056.7708" x="694.7917" y="409.8226"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="710.4167" y="423.4339">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="777.0833" y="422.5418">[RegService-OpenID-Token]</text><polygon fill="#383838" points="1639.0625,461.2793,1649.4792,465.446,1639.0625,469.6126,1643.2292,465.446" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="1645.3125" y1="465.446" y2="465.446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="147.9167" x="772.3958" y="444.4056">GET /openid/userinfo/?</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="772.3958" y="460.169">access_token=RegService-OpenID-Token)</text><polygon fill="#383838" points="776.5625,507.3893,766.1458,511.556,776.5625,515.7227,772.3958,511.556" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="770.3125" x2="1655.7292" y1="511.556" y2="511.556"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="782.8125" y="490.5156">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="375" x="782.8125" y="506.279">(Result Body userid des Org-Admin auf dem Reg-Server)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="541.9027" y2="541.9027"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="541.9027" y2="555.4443"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="555.4443" y2="555.4443"/><polygon fill="#383838" points="776.5625,551.2777,766.1458,555.4443,776.5625,559.611,772.3958,555.4443" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="80.2083" x="772.3958" y="536.6257">verify userid</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="593.0827" y2="593.0827"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="593.0827" y2="606.6243"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="606.6243" y2="606.6243"/><polygon fill="#383838" points="776.5625,602.4577,766.1458,606.6243,776.5625,610.791,772.3958,606.6243" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="772.3958" y="587.8057">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#383838" points="257.8125,632.8044,247.3958,636.971,257.8125,641.1377,253.6458,636.971" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="753.6458" y1="636.971" y2="636.971"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="264.0625" y="631.694">Redirect to IDP Authorization Endpoint</text><polygon fill="#383838" points="1276.5625,663.151,1286.9792,667.3177,1276.5625,671.4844,1280.7292,667.3177" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="1282.8125" y1="667.3177" y2="667.3177"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="253.6458" y="662.0407">GET /authorize</text><polygon fill="#383838" points="257.8125,693.4977,247.3958,697.6644,257.8125,701.8311,253.6458,697.6644" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1288.0208" y1="697.6644" y2="697.6644"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="264.0625" y="692.3874">Authentication challenge</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="559.8958" x2="603.6458" y1="728.0111" y2="728.0111"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="603.6458" x2="603.6458" y1="728.0111" y2="741.5527"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="560.9375" x2="603.6458" y1="741.5527" y2="741.5527"/><polygon fill="#383838" points="571.3542,737.3861,560.9375,741.5527,571.3542,745.7194,567.1875,741.5527" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="567.1875" y="722.7341">Authentication</text><polygon fill="#383838" points="1271.3542,767.7327,1281.7708,771.8994,1271.3542,776.0661,1275.5208,771.8994" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="554.6875" x2="1277.6042" y1="771.8994" y2="771.8994"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="561.9792" y="766.6224">Authentication challenge response</text><polygon fill="#383838" points="257.8125,798.0794,247.3958,802.2461,257.8125,806.4128,253.6458,802.2461" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1282.8125" y1="802.2461" y2="802.2461"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="264.0625" y="796.9691">Authorization Response with Authorization code</text><polygon fill="#383838" points="742.1875,828.4261,752.6042,832.5928,742.1875,836.7594,746.3542,832.5928" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="832.5928" y2="832.5928"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="322.9167" x="253.6458" y="827.3158">GET /owner-authenticate with Authorization code</text><polygon fill="#383838" points="1271.3542,858.7728,1281.7708,862.9395,1271.3542,867.1061,1275.5208,862.9395" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="1277.6042" y1="862.9395" y2="862.9395"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="772.3958" y="857.6625">POST /tokenEndpoint {authorization code}</text><polygon fill="#383838" points="776.5625,889.1195,766.1458,893.2861,776.5625,897.4528,772.3958,893.2861" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="770.3125" x2="1288.0208" y1="893.2861" y2="893.2861"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="782.8125" y="888.0091">Response {id_token}</text><path d="M694.7917,908.9111 L761.4583,908.9111 L761.4583,916.2028 L751.0417,926.6195 L694.7917,926.6195 L694.7917,908.9111 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="107.7067" style="stroke:#000000;stroke-width:2.0833333333333335;" width="402.6042" x="694.7917" y="908.9111"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="710.4167" y="922.5225">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="777.0833" y="921.6304">[RegService-OpenID-Token]</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="948.7712" y2="948.7712"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="948.7712" y2="962.3128"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="962.3128" y2="962.3128"/><polygon fill="#383838" points="776.5625,958.1462,766.1458,962.3128,776.5625,966.4795,772.3958,962.3128" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="312.5" x="772.3958" y="943.4942">Prüfe idtoken (professionOID for Organization?)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="694.7917" x2="1097.3958" y1="971.6878" y2="971.6878"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="994.7428" y2="994.7428"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="994.7428" y2="1008.2845"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="1008.2845" y2="1008.2845"/><polygon fill="#383838" points="776.5625,1004.1178,766.1458,1008.2845,776.5625,1012.4512,772.3958,1008.2845" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="304.1667" x="772.3958" y="989.4658">Prüfe idtoken (professionOID for Practitioner?)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="1045.9229" y2="1045.9229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="1045.9229" y2="1059.4645"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="1059.4645" y2="1059.4645"/><polygon fill="#383838" points="776.5625,1055.2979,766.1458,1059.4645,776.5625,1063.6312,772.3958,1059.4645" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="772.3958" y="1040.6459">erzeuge owner-accesstoken</text><polygon fill="#383838" points="257.8125,1085.6445,247.3958,1089.8112,257.8125,1093.9779,253.6458,1089.8112" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="758.8542" y1="1089.8112" y2="1089.8112"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="264.0625" y="1084.5342">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#383838" points="1079.6875,1123.2829,1090.1042,1127.4495,1079.6875,1131.6162,1083.8542,1127.4495" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="246.3542" x2="1085.9375" y1="1127.4495" y2="1127.4495"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="253.6458" y="1122.1725">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1102.6042" x2="1146.3542" y1="1157.7962" y2="1157.7962"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1146.3542" x2="1146.3542" y1="1157.7962" y2="1171.3379"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1103.6458" x2="1146.3542" y1="1171.3379" y2="1171.3379"/><polygon fill="#383838" points="1114.0625,1167.1712,1103.6458,1171.3379,1114.0625,1175.5046,1109.8958,1171.3379" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1109.8958" y="1152.5192">prüfe owner-accesstoken</text><polygon fill="#383838" points="1483.8542,1197.5179,1494.2708,1201.6846,1483.8542,1205.8512,1488.0208,1201.6846" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1102.6042" x2="1490.1042" y1="1201.6846" y2="1201.6846"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1109.8958" y="1196.4076">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#383838" points="1114.0625,1227.8646,1103.6458,1232.0313,1114.0625,1236.1979,1109.8958,1232.0313" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1107.8125" x2="1495.3125" y1="1232.0313" y2="1232.0313"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1120.3125" y="1226.7543">HTTP 200 OK (Result Body json)</text><polygon fill="#383838" points="252.6042,1258.2113,242.1875,1262.3779,252.6042,1266.5446,248.4375,1262.3779" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="246.3542" x2="1096.3542" y1="1262.3779" y2="1262.3779"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="258.8542" y="1257.1009">HTTP 200 OK (Result Body json)</text><!--MD5=[b07714b1105d89f6e7a217d4d7d51602]
@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen TIOrganization- oder TIPractitioner-Einträgen'
actor o as "Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>