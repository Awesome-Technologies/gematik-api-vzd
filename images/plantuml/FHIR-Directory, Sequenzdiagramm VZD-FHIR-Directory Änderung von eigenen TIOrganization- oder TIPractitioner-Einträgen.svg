<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1014.5833px" preserveAspectRatio="none" style="width:1417px;height:1014px;background:#FFFFFF;" version="1.1" viewBox="0 0 1417 1014" width="1417.7083px" zoomAndPan="magnify"><defs><filter height="300%" id="fi4pntbxnwxik" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="767.9036" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="271.3542" y="140.1693"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="609.8958" y="390.2344"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="420.5485" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="748.9583" y="299.1943"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="960.4167" y="773.1445"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1166.6667" y="464.4694"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1341.6667" y="847.3796"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="512.6302" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1064.5833" x="184.375" y="215.446"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="57.2917" x2="57.2917" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="276.0417" x2="276.0417" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="615.1042" x2="615.1042" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="753.6458" x2="753.6458" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="965.1042" x2="965.1042" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1171.875" x2="1171.875" y1="91.9759" y2="926.8229"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1346.875" x2="1346.875" y1="91.9759" y2="926.8229"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="5.2083" y="88.5366">Admin_Owner</text><ellipse cx="57.8125" cy="15.625" fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M57.8125,23.9583 L57.8125,52.0833 M44.2708,32.2917 L71.3542,32.2917 M57.8125,52.0833 L44.2708,67.7083 M57.8125,52.0833 L71.3542,67.7083 " fill="none" filter="url(#fi4pntbxnwxik)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="5.2083" y="939.3178">Admin_Owner</text><ellipse cx="57.8125" cy="953.1738" fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M57.8125,961.5072 L57.8125,989.6322 M44.2708,969.8405 L71.3542,969.8405 M57.8125,989.6322 L44.2708,1005.2572 M57.8125,989.6322 L71.3542,1005.2572 " fill="none" filter="url(#fi4pntbxnwxik)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="194.7917" y="21.2565"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="213.5417" y="42.0848">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="257.8125" y="59.0607">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="202.0833" y="76.0366">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="65.5111" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="194.7917" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="213.5417" y="946.6095">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="257.8125" y="963.5854">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="202.0833" y="980.5613">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="541.1458" y="38.2324"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="548.4375" y="59.0607">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="585.4167" y="76.0366">des IDP</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="143.75" x="541.1458" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="548.4375" y="946.6095">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="585.4167" y="963.5854">des IDP</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="699.4792" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="706.7708" y="76.0366">Auth-Service</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="699.4792" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="706.7708" y="946.6095">Auth-Service</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="918.2292" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="925.5208" y="76.0366">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="918.2292" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="925.5208" y="946.6095">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1105.2083" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1112.5" y="76.0366">Identity Provider</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="129.1667" x="1105.2083" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1112.5" y="946.6095">Identity Provider</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1286.4583" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1293.75" y="76.0366">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#fi4pntbxnwxik)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1286.4583" y="925.7813"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1293.75" y="946.6095">FHIR-Directory</text><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="767.9036" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="271.3542" y="140.1693"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="74.235" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="609.8958" y="390.2344"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="420.5485" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="748.9583" y="299.1943"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="134.9284" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="960.4167" y="773.1445"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="121.3867" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1166.6667" y="464.4694"/><rect fill="#FFFFFF" filter="url(#fi4pntbxnwxik)" height="60.6934" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1341.6667" y="847.3796"/><polygon fill="#383838" points="258.8542,136.0026,269.2708,140.1693,258.8542,144.3359,263.0208,140.1693" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="57.8125" x2="265.1042" y1="140.1693" y2="140.1693"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="193.75" x="65.1042" y="119.1289">mÃ¶chte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="56.25" x="65.1042" y="134.8923">Ã¤ndern</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="325.5208" y1="186.2793" y2="186.2793"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="325.5208" x2="325.5208" y1="186.2793" y2="199.821"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="282.8125" x2="325.5208" y1="199.821" y2="199.821"/><polygon fill="#383838" points="293.2292,195.6543,282.8125,199.821,293.2292,203.9876,289.0625,199.821" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="309.375" x="289.0625" y="165.239">prÃ¼fe ob noch gÃ¼ltiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="303.125" x="289.0625" y="181.0023">fÃ¼r Schreibzugriff vom Auth-Service vorliegt</text><path d="M184.375,215.446 L251.0417,215.446 L251.0417,222.7376 L240.625,233.1543 L184.375,233.1543 L184.375,215.446 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="512.6302" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1064.5833" x="184.375" y="215.446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="200" y="229.0573">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="450" x="266.6667" y="228.1652">[kein gÃ¼ltiges owner-accesstoken fÃ¼r Schreibzugriff vorhanden]</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="325.5208" y1="255.306" y2="255.306"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="325.5208" x2="325.5208" y1="255.306" y2="268.8477"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="282.8125" x2="325.5208" y1="268.8477" y2="268.8477"/><polygon fill="#383838" points="293.2292,264.681,282.8125,268.8477,293.2292,273.0143,289.0625,268.8477" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="313.5417" x="289.0625" y="250.029">Erzeuge PKCE Code fÃ¼r verifier und challenge</text><polygon fill="#383838" points="736.4583,295.0277,746.875,299.1943,736.4583,303.361,740.625,299.1943" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="742.7083" y1="299.1943" y2="299.1943"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="289.0625" y="293.9173">GET /owner-authenticate</text><polygon fill="#383838" points="293.2292,325.3743,282.8125,329.541,293.2292,333.7077,289.0625,329.541" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="286.9792" x2="747.9167" y1="329.541" y2="329.541"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="299.4792" y="324.264">Redirect to IDP Authorization Endpoint</text><polygon fill="#383838" points="1159.375,355.721,1169.7917,359.8877,1159.375,364.0544,1163.5417,359.8877" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="1165.625" y1="359.8877" y2="359.8877"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="289.0625" y="354.6107">GET /authorize</text><polygon fill="#383838" points="293.2292,386.0677,282.8125,390.2344,293.2292,394.401,289.0625,390.2344" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="286.9792" x2="1170.8333" y1="390.2344" y2="390.2344"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="299.4792" y="384.9574">Authentication challenge</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="620.3125" x2="664.0625" y1="420.5811" y2="420.5811"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="664.0625" x2="664.0625" y1="420.5811" y2="434.1227"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="621.3542" x2="664.0625" y1="434.1227" y2="434.1227"/><polygon fill="#383838" points="631.7708,429.9561,621.3542,434.1227,631.7708,438.2894,627.6042,434.1227" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="627.6042" y="415.3041">Authentication</text><polygon fill="#383838" points="1154.1667,460.3027,1164.5833,464.4694,1154.1667,468.6361,1158.3333,464.4694" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="615.1042" x2="1160.4167" y1="464.4694" y2="464.4694"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="622.3958" y="459.1924">Authentication challenge response</text><polygon fill="#383838" points="293.2292,490.6494,282.8125,494.8161,293.2292,498.9827,289.0625,494.8161" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="286.9792" x2="1165.625" y1="494.8161" y2="494.8161"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="299.4792" y="489.5391">Authorization Response with Authorization code</text><polygon fill="#383838" points="736.4583,520.9961,746.875,525.1628,736.4583,529.3294,740.625,525.1628" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="742.7083" y1="525.1628" y2="525.1628"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="322.9167" x="289.0625" y="519.8858">GET /owner-authenticate with Authorization code</text><polygon fill="#383838" points="1154.1667,551.3428,1164.5833,555.5094,1154.1667,559.6761,1158.3333,555.5094" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="759.375" x2="1160.4167" y1="555.5094" y2="555.5094"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="766.6667" y="550.2324">POST /tokenEndpoint {authorization code}</text><polygon fill="#383838" points="770.8333,581.6895,760.4167,585.8561,770.8333,590.0228,766.6667,585.8561" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="764.5833" x2="1170.8333" y1="585.8561" y2="585.8561"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="777.0833" y="580.5791">Response {id_token}</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="759.375" x2="803.125" y1="616.2028" y2="616.2028"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="803.125" x2="803.125" y1="616.2028" y2="629.7445"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="760.4167" x2="803.125" y1="629.7445" y2="629.7445"/><polygon fill="#383838" points="770.8333,625.5778,760.4167,629.7445,770.8333,633.9111,766.6667,629.7445" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="102.0833" x="766.6667" y="610.9258">PrÃ¼fe idtoken</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="759.375" x2="803.125" y1="660.0911" y2="660.0911"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="803.125" x2="803.125" y1="660.0911" y2="673.6328"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="760.4167" x2="803.125" y1="673.6328" y2="673.6328"/><polygon fill="#383838" points="770.8333,669.4661,760.4167,673.6328,770.8333,677.7995,766.6667,673.6328" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="766.6667" y="654.8141">erzeuge owner-accesstoken</text><polygon fill="#383838" points="293.2292,715.5762,282.8125,719.7428,293.2292,723.9095,289.0625,719.7428" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="286.9792" x2="753.125" y1="719.7428" y2="719.7428"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="170.8333" x="299.4792" y="698.7025">HTTP 200 OK, Result body</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="267.7083" x="299.4792" y="714.4658">{"access_token"="owner-accesstoken"}</text><polygon fill="#383838" points="947.9167,768.9779,958.3333,773.1445,947.9167,777.3112,952.0833,773.1445" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="281.7708" x2="954.1667" y1="773.1445" y2="773.1445"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="394.7917" x="289.0625" y="752.1042">GET /owner/TIHealthcareService?providedBy.id=telematikID</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="269.7917" x="289.0625" y="767.8675">Authorization Bearer owner-accesstoken</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="970.8333" x2="1014.5833" y1="803.4912" y2="803.4912"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="1014.5833" x2="1014.5833" y1="803.4912" y2="817.0329"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="971.875" x2="1014.5833" y1="817.0329" y2="817.0329"/><polygon fill="#383838" points="982.2917,812.8662,971.875,817.0329,982.2917,821.1995,978.125,817.0329" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="181.25" x="978.125" y="798.2142">prÃ¼fe owner-accesstoken</text><polygon fill="#383838" points="1329.1667,843.2129,1339.5833,847.3796,1329.1667,851.5462,1333.3333,847.3796" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="970.8333" x2="1335.4167" y1="847.3796" y2="847.3796"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="351.0417" x="978.125" y="842.1026">GET /TIHealthcareService?providedBy.id=telematikID</text><polygon fill="#383838" points="982.2917,873.5596,971.875,877.7262,982.2917,881.8929,978.125,877.7262" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="976.0417" x2="1340.625" y1="877.7262" y2="877.7262"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="988.5417" y="872.4492">HTTP 200 OK (Result Body json)</text><polygon fill="#383838" points="288.0208,903.9063,277.6042,908.0729,288.0208,912.2396,283.8542,908.0729" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="281.7708" x2="964.5833" y1="908.0729" y2="908.0729"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="294.2708" y="902.7959">HTTP 200 OK (Result Body json)</text><!--MD5=[c25f38541f3018a9acf2ea3517b2a527]
@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Ãnderung von eigenen TIOrganization- oder TIPractitioner-EintrÃ¤gen'
actor oa as "Admin_Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
oa -> cl: mÃ¶chte seinen FHIR-Eintrag\nÃ¤ndern
activate cl
cl -> cl: prÃ¼fe ob noch gÃ¼ltiges owner-accesstoken\nfÃ¼r Schreibzugriff vom Auth-Service vorliegt
alt kein gÃ¼ltiges owner-accesstoken fÃ¼r Schreibzugriff vorhanden
cl -> cl: Erzeuge PKCE Code fÃ¼r verifier und challenge
cl -> au: GET /owner-authenticate
activate au
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

'cl -> idp: GET /authorize + scope=VZD-FHIR-Directory + openid + code_challenge
'activate idp
'idp - -> cl: HTTP 200 OK (Result Body "BestÃ¤tige IdentitÃ¤t in der Authenticator App des IDP")
'oa -> aa: Authentisierung und\nEinverstÃ¤ndnis
'activate aa
'aa -> idp: Authentisierung und EinverstÃ¤ndnis
'deactivate aa
'idp - -> cl: HTTP 200 OK (Result Body {"AuthorizationCode"})

'cl -> idp: POST /token\ngrant_type=authorization_code\ncode="AuthorizationCode"\ncode_verifier="verifier"
'idp -> idp: Auswertung des PKCE codes
'idp - -> cl: HTTP 200 OK (Result Body {\n"id_token": "idtoken"\n"access_token": "accesstoken"\n"refresh_token": "refreshtoken"...})
deactivate idp
'cl -> fp: GET /owner-authenticate... (Auth Header mit\naccesstoken und idtoken)
au -> au: PrÃ¼fe idtoken
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: GET /owner/TIHealthcareService?providedBy.id=telematikID\nAuthorization Bearer owner-accesstoken
activate fp
fp -> fp: prÃ¼fe owner-accesstoken
fp -> fd: GET /TIHealthcareService?providedBy.id=telematikID
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor oa as "Admin_Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
oa -> cl: mÃ¶chte seinen FHIR-Eintrag\nÃ¤ndern
activate cl
cl -> cl: prÃ¼fe ob noch gÃ¼ltiges owner-accesstoken\nfÃ¼r Schreibzugriff vom Auth-Service vorliegt
alt kein gÃ¼ltiges owner-accesstoken fÃ¼r Schreibzugriff vorhanden
cl -> cl: Erzeuge PKCE Code fÃ¼r verifier und challenge
cl -> au: GET /owner-authenticate
activate au
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}


deactivate idp
au -> au: PrÃ¼fe idtoken
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: GET /owner/TIHealthcareService?providedBy.id=telematikID\nAuthorization Bearer owner-accesstoken
activate fp
fp -> fp: prÃ¼fe owner-accesstoken
fp -> fd: GET /TIHealthcareService?providedBy.id=telematikID
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>