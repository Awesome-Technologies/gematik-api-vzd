<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1252.0833px" preserveAspectRatio="none" style="width:1467px;height:1252px;background:#FFFFFF;" version="1.1" viewBox="0 0 1467 1252" width="1467.7083px" zoomAndPan="magnify"><defs><filter height="300%" id="fkvr1d2ow4jis" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0833333333333335"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.166666666666667" dy="4.166666666666667" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="1043.9372" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="185.4167" y="102.3926"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="503.5319" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="522.9167" y="642.7979"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="273.3968" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="811.4583" y="315.9993"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="122.5667" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="786.0596"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="971.403"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1360.4167" y="255.306"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1360.4167" y="421.7611"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="382.2835" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1354.6875" x="98.4375" y="215.446"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="170.7601" style="stroke:#000000;stroke-width:2.0833333333333335;" width="818.2292" x="470.3125" y="746.1995"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="94.3034" style="stroke:#000000;stroke-width:2.0833333333333335;" width="818.2292" x="470.3125" y="931.543"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="32.2917" x2="32.2917" y1="91.9759" y2="1165.0798"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="190.1042" x2="190.1042" y1="91.9759" y2="1165.0798"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="527.6042" x2="527.6042" y1="91.9759" y2="1165.0798"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="816.1458" x2="816.1458" y1="91.9759" y2="1165.0798"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1217.7083" x2="1217.7083" y1="91.9759" y2="1165.0798"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="1365.625" x2="1365.625" y1="91.9759" y2="1165.0798"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="47.9167" x="5.2083" y="88.5366">Nutzer</text><ellipse cx="32.2917" cy="15.625" fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M32.2917,23.9583 L32.2917,52.0833 M18.75,32.2917 L45.8333,32.2917 M32.2917,52.0833 L18.75,67.7083 M32.2917,52.0833 L45.8333,67.7083 " fill="none" filter="url(#fkvr1d2ow4jis)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="47.9167" x="5.2083" y="1177.5747">Nutzer</text><ellipse cx="32.2917" cy="1191.4307" fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" rx="8.3333" ry="8.3333" style="stroke:#383838;stroke-width:2.0833333333333335;"/><path d="M32.2917,1199.764 L32.2917,1227.889 M18.75,1208.0973 L45.8333,1208.0973 M32.2917,1227.889 L18.75,1243.514 M32.2917,1227.889 L45.8333,1243.514 " fill="none" filter="url(#fkvr1d2ow4jis)" style="stroke:#383838;stroke-width:2.0833333333333335;"/><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="108.8542" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="116.1458" y="76.0366">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="159.375" x="108.8542" y="1164.0381"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="116.1458" y="1184.8663">TI-Messenger-Client</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="480.7292" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="488.0208" y="76.0366">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="90.625" x="480.7292" y="1164.0381"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="488.0208" y="1184.8663">FHIR-Proxy</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="761.9792" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="769.2708" y="76.0366">Auth-Service</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="105.2083" x="761.9792" y="1164.0381"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="769.2708" y="1184.8663">Auth-Service</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1157.2917" y="55.2083"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1164.5833" y="76.0366">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="31.5592" style="stroke:#383838;stroke-width:1.5625;" width="116.6667" x="1157.2917" y="1164.0381"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1164.5833" y="1184.8663">FHIR-Directory</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="150" x="1288.5417" y="38.2324"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="134.375" x="1296.3542" y="59.0607">Matrix-Homeserver</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="135.4167" x="1295.8333" y="76.0366">(Messenger-Proxy)</text><rect fill="#F8F8F8" filter="url(#fkvr1d2ow4jis)" height="48.5352" style="stroke:#383838;stroke-width:1.5625;" width="150" x="1288.5417" y="1164.0381"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="134.375" x="1296.3542" y="1184.8663">Matrix-Homeserver</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="135.4167" x="1295.8333" y="1201.8422">(Messenger-Proxy)</text><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="1043.9372" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="185.4167" y="102.3926"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="503.5319" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="522.9167" y="642.7979"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="273.3968" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="811.4583" y="315.9993"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="122.5667" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="786.0596"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="971.403"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="30.3467" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1360.4167" y="255.306"/><rect fill="#FFFFFF" filter="url(#fkvr1d2ow4jis)" height="46.11" style="stroke:#383838;stroke-width:1.0416666666666667;" width="10.4167" x="1360.4167" y="421.7611"/><polygon fill="#383838" points="172.9167,136.0026,183.3333,140.1693,172.9167,144.3359,177.0833,140.1693" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="32.2917" x2="179.1667" y1="140.1693" y2="140.1693"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="39.5833" y="119.1289">gibt FHIR-</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="128.125" x="39.5833" y="134.8923">Suchparameter ein</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="195.8333" x2="239.5833" y1="186.2793" y2="186.2793"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="239.5833" x2="239.5833" y1="186.2793" y2="199.821"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="196.875" x2="239.5833" y1="199.821" y2="199.821"/><polygon fill="#383838" points="207.2917,195.6543,196.875,199.821,207.2917,203.9876,203.125,199.821" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="312.5" x="203.125" y="165.239">prüfe ob noch gültiges tim-search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="157.2917" x="203.125" y="181.0023">vom FHIR-Proxy vorliegt</text><path d="M98.4375,215.446 L165.1042,215.446 L165.1042,222.7376 L154.6875,233.1543 L98.4375,233.1543 L98.4375,215.446 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="382.2835" style="stroke:#000000;stroke-width:2.0833333333333335;" width="1354.6875" x="98.4375" y="215.446"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="114.0625" y="229.0573">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="335.4167" x="180.7292" y="228.1652">[kein gültiges tim-search-accesstoken vorhanden]</text><polygon fill="#383838" points="1347.9167,251.1393,1358.3333,255.306,1347.9167,259.4727,1352.0833,255.306" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="195.8333" x2="1354.1667" y1="255.306" y2="255.306"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="394.7917" x="203.125" y="250.029">POST /_matrix/client/r0/user/{userId}/openid/request_token</text><polygon fill="#383838" points="207.2917,281.486,196.875,285.6527,207.2917,289.8193,203.125,285.6527" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="201.0417" x2="1364.5833" y1="285.6527" y2="285.6527"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="750" x="213.5417" y="280.3757">HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}</text><polygon fill="#383838" points="798.9583,311.8327,809.375,315.9993,798.9583,320.166,803.125,315.9993" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="195.8333" x2="805.2083" y1="315.9993" y2="315.9993"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="427.0833" x="203.125" y="310.7224">GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="821.875" x2="865.625" y1="362.1094" y2="362.1094"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="865.625" x2="865.625" y1="362.1094" y2="375.651"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="822.9167" x2="865.625" y1="375.651" y2="375.651"/><polygon fill="#383838" points="833.3333,371.4844,822.9167,375.651,833.3333,379.8177,829.1667,375.651" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="196.875" x="829.1667" y="341.069">Prüfe ob matrix_server_name</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="188.5417" x="829.1667" y="356.8324">in Föderationsliste enthalten</text><polygon fill="#383838" points="1347.9167,417.5944,1358.3333,421.7611,1347.9167,425.9277,1352.0833,421.7611" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="821.875" x2="1354.1667" y1="421.7611" y2="421.7611"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="147.9167" x="829.1667" y="400.7207">GET /openid/userinfo/?</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="246.875" x="829.1667" y="416.4841">access_token=Matrix-OpenID-Token)</text><polygon fill="#383838" points="833.3333,463.7044,822.9167,467.8711,833.3333,472.0378,829.1667,467.8711" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="827.0833" x2="1364.5833" y1="467.8711" y2="467.8711"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="839.5833" y="446.8307">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="210.4167" x="839.5833" y="462.5941">(Result Body MXID des Nutzers)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="821.875" x2="865.625" y1="498.2178" y2="498.2178"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="865.625" x2="865.625" y1="498.2178" y2="511.7594"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="822.9167" x2="865.625" y1="511.7594" y2="511.7594"/><polygon fill="#383838" points="833.3333,507.5928,822.9167,511.7594,833.3333,515.9261,829.1667,511.7594" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="376.0417" x="829.1667" y="492.9408">erzeuge tim-search-accesstoken für TI-Messenger-Client</text><polygon fill="#383838" points="207.2917,585.2295,196.875,589.3962,207.2917,593.5628,203.125,589.3962" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="201.0417" x2="815.625" y1="589.3962" y2="589.3962"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="170.8333" x="213.5417" y="536.8291">HTTP 200 OK, Result body</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="218.75" x="213.5417" y="552.5925">{"access_token"="accesstoken",</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="146.875" x="213.5417" y="568.3558">"token_type":"bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="131.25" x="213.5417" y="584.1192">"expires_in":86400}</text><polygon fill="#383838" points="510.4167,638.6312,520.8333,642.7979,510.4167,646.9645,514.5833,642.7979" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="195.8333" x2="516.6667" y1="642.7979" y2="642.7979"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="245.8333" x="203.125" y="621.7575">GET /tim-search?... (Auth Header mit</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="165.625" x="203.125" y="637.5209">tim-search-accesstoken)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="673.1445" y2="673.1445"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="673.1445" y2="686.6862"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="686.6862" y2="686.6862"/><polygon fill="#383838" points="544.7917,682.5195,534.375,686.6862,544.7917,690.8529,540.625,686.6862" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="198.9583" x="540.625" y="667.8675">prüfe tim-search-accesstoken</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="717.0329" y2="717.0329"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="717.0329" y2="730.5745"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="730.5745" y2="730.5745"/><polygon fill="#383838" points="544.7917,726.4079,534.375,730.5745,544.7917,734.7412,540.625,730.5745" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="263.5417" x="540.625" y="711.7559">werden TIPractitioner-Einträge gesucht?</text><path d="M470.3125,746.1995 L536.9792,746.1995 L536.9792,753.4912 L526.5625,763.9079 L470.3125,763.9079 L470.3125,746.1995 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="170.7601" style="stroke:#000000;stroke-width:2.0833333333333335;" width="818.2292" x="470.3125" y="746.1995"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="485.9375" y="759.8109">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="303.125" x="552.6042" y="758.9188">[TIPractitionerRole-Einträge werden gesucht]</text><polygon fill="#383838" points="1200,781.8929,1210.4167,786.0596,1200,790.2262,1204.1667,786.0596" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="786.0596" y2="786.0596"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="159.375" x="540.625" y="780.7826">GET /?...&lt;eigene MXID&gt;</text><polygon fill="#383838" points="544.7917,828.0029,534.375,832.1696,544.7917,836.3363,540.625,832.1696" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1211.4583" y1="832.1696" y2="832.1696"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="811.1293">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="551.0417" y="826.8926">(Result Body json mit TIPractitioner-Eintrag)</text><polygon fill="#383838" points="1200,858.3496,1210.4167,862.5163,1200,866.6829,1204.1667,862.5163" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="862.5163" y2="862.5163"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="54.1667" x="540.625" y="857.2393">GET /?...</text><polygon fill="#383838" points="544.7917,904.4596,534.375,908.6263,544.7917,912.793,540.625,908.6263" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1216.6667" y1="908.6263" y2="908.6263"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="887.586">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="119.7917" x="551.0417" y="903.3493">(Result Body json)</text><path d="M470.3125,931.543 L536.9792,931.543 L536.9792,938.8346 L526.5625,949.2513 L470.3125,949.2513 L470.3125,931.543 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0416666666666667;"/><rect fill="none" height="94.3034" style="stroke:#000000;stroke-width:2.0833333333333335;" width="818.2292" x="470.3125" y="931.543"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="485.9375" y="945.1543">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="317.7083" x="552.6042" y="944.2622">[TIHealthcareService-Einträge werden gesucht]</text><polygon fill="#383838" points="1200,967.2363,1210.4167,971.403,1200,975.5697,1204.1667,971.403" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="971.403" y2="971.403"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="54.1667" x="540.625" y="966.126">GET /?...</text><polygon fill="#383838" points="544.7917,1013.3464,534.375,1017.513,544.7917,1021.6797,540.625,1017.513" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1216.6667" y1="1017.513" y2="1017.513"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="996.4727">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="119.7917" x="551.0417" y="1012.236">(Result Body json)</text><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="1086.6781" y2="1086.6781"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="1086.6781" y2="1100.2197"/><line style="stroke:#383838;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="1100.2197" y2="1100.2197"/><polygon fill="#383838" points="544.7917,1096.0531,534.375,1100.2197,544.7917,1104.3864,540.625,1100.2197" style="stroke:#383838;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="92.7083" x="540.625" y="1049.8744">prüfe telecom</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="540.625" y="1065.6377">Elemente</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="153.125" x="540.625" y="1081.4011">und ergänze PASSporT</text><polygon fill="#383838" points="202.0833,1142.1631,191.6667,1146.3298,202.0833,1150.4964,197.9167,1146.3298" style="stroke:#383838;stroke-width:1.0416666666666667;"/><line style="stroke:#383838;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="195.8333" x2="527.0833" y1="1146.3298" y2="1146.3298"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="208.3333" y="1125.2894">HTTP 200 OK (Result Body json mit</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="137.5" x="208.3333" y="1141.0528">MXID und PASSporT)</text><!--MD5=[24c999bde1cc46e48af2eb66e9f0b208]
@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram tim-search'
actor Nutzer
participant cl as "TI-Messenger-Client"
participant fp as "FHIR-Proxy"
participant au as "Auth-Service"
participant fd as "FHIR-Directory"
participant hs as "Matrix-Homeserver\n(Messenger-Proxy)"
activate cl
Nutzer -> cl:gibt FHIR-\nSuchparameter ein
cl -> cl: prüfe ob noch gültiges tim-search-accesstoken\nvom FHIR-Proxy vorliegt
alt kein gültiges tim-search-accesstoken vorhanden
cl -> hs: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate hs
hs - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}
deactivate hs
cl -> au: GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)
activate au
au -> au: Prüfe ob matrix_server_name\nin Föderationsliste enthalten
au -> hs: GET /openid/userinfo/?\naccess_token=Matrix-OpenID-Token)
activate hs
hs - -> au: HTTP 200 OK\n(Result Body MXID des Nutzers)
deactivate hs
au -> au: erzeuge tim-search-accesstoken für TI-Messenger-Client
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="accesstoken",\n"token_type":"bearer",\n"expires_in":86400}
deactivate au
end
cl -> fp: GET /tim-search?... (Auth Header mit\ntim-search-accesstoken)
activate fp
fp -> fp: prüfe tim-search-accesstoken
fp -> fp: werden TIPractitioner-Einträge gesucht?
alt TIPractitionerRole-Einträge werden gesucht
fp -> fd: GET /?...<eigene MXID>
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json mit TIPractitioner-Eintrag)
fp -> fd: GET /?...
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
alt TIHealthcareService-Einträge werden gesucht
fp -> fd: GET /?...
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
fp -> fp: prüfe telecom\nElemente\nund ergänze PASSporT
fp - -> cl: HTTP 200 OK (Result Body json mit\nMXID und PASSporT)
deactivate fp
deactivate cl
@enduml

@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor Nutzer
participant cl as "TI-Messenger-Client"
participant fp as "FHIR-Proxy"
participant au as "Auth-Service"
participant fd as "FHIR-Directory"
participant hs as "Matrix-Homeserver\n(Messenger-Proxy)"
activate cl
Nutzer -> cl:gibt FHIR-\nSuchparameter ein
cl -> cl: prüfe ob noch gültiges tim-search-accesstoken\nvom FHIR-Proxy vorliegt
alt kein gültiges tim-search-accesstoken vorhanden
cl -> hs: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate hs
hs - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}
deactivate hs
cl -> au: GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)
activate au
au -> au: Prüfe ob matrix_server_name\nin Föderationsliste enthalten
au -> hs: GET /openid/userinfo/?\naccess_token=Matrix-OpenID-Token)
activate hs
hs - -> au: HTTP 200 OK\n(Result Body MXID des Nutzers)
deactivate hs
au -> au: erzeuge tim-search-accesstoken für TI-Messenger-Client
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="accesstoken",\n"token_type":"bearer",\n"expires_in":86400}
deactivate au
end
cl -> fp: GET /tim-search?... (Auth Header mit\ntim-search-accesstoken)
activate fp
fp -> fp: prüfe tim-search-accesstoken
fp -> fp: werden TIPractitioner-Einträge gesucht?
alt TIPractitionerRole-Einträge werden gesucht
fp -> fd: GET /?...<eigene MXID>
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json mit TIPractitioner-Eintrag)
fp -> fd: GET /?...
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
alt TIHealthcareService-Einträge werden gesucht
fp -> fd: GET /?...
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
fp -> fp: prüfe telecom\nElemente\nund ergänze PASSporT
fp - -> cl: HTTP 200 OK (Result Body json mit\nMXID und PASSporT)
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>